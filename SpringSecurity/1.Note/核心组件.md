# 核心组件

## SecurityContext

- **作用：**保留系统当前的安全上下文细节，其中就包括当前使用系统的用户的信息。
- **"当前用户"账号信息和相关权限**
- 保存**Authentication**（认证授权信息）
  - 用户权限集合 => 可用于访问受保护资源时的权限验证
  - 用户证书（密码） => 初次认证的时候，进行填充，认证成功后将被清空
  - 细节 => 暂不清楚，猜测应该是记录哪些保护资源已经验证授权，下次不用再验证，等等。
  - Pirncipal => 大概就是账号吧 ?= UserDetails（用户信息）
  - 是否已认证成功

## AuthenticationManager

### 1.验证步骤

1. AuthenticationManager（interface）
   - authenticate() 方法
2. ProviderManager
   - authenticate() 方法
3. AuthenticationProvider（interface）
4. AbstractUserDetailsAuthenticationProvider（实现）
   - `authenticate()`
5. DaoAuthenticationProvider
6. retrieveUser(username, (UsernamePasswordAuthenticationToken)authentication)
   - 调用 `UserDetailsService.loadUserByUsername()`）
7. UserDetailsService
8. UserDetail 
   1. 由 `loadUserByUsername()` 调用
   2. 返回 UserDetails (SecurityUser)
   3. 在数据库通过 **用户名** 查找：**用户名**、**密码**、**角色**

![image-20210824091900572](https://raw.githubusercontent.com/TWDH/Leetcode-From-Zero/pictures/img/image-20210824091900572.png)

- 用于抽象建模认证管理器，用于处理一个认证请求，也就是`Spring Security`中的`Authentication`认证令牌。
- ![image-20210823105946692](C:\Users\Kevin.Zhu\AppData\Roaming\Typora\typora-user-images\image-20210823105946692.png)

![20201013224010525](https://raw.githubusercontent.com/TWDH/Leetcode-From-Zero/pictures/img/20201013224010525.png)

## AuthenticationManagerBuilder

- 设置自己的 `UserDetailService`
- `authenticationManagerBuilder.userDetailsService(this.customUserDetailsService);`

```
Best Regards, 
He Zhu | Junior Developer
OTT Financial Group  
1123 Leslie Street, Toronto, ON Canada M3C 2K5 
Tel: 416-499-2258 | Fax: 416-391-2992 | www.ott.ca 
  
This email and any attachments are confidential, privileged or subject to copyright. Any unauthorized view, disclosure or use is prohibited. Please be advised that no authorization is granted by the OTT Group of Companies for entering into binding contracts or transactions by email on its behalf. If you are not the intended recipient, please notify the sender and permanently delete this email and any copies immediately. 

```

